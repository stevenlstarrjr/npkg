#pragma once

#include <filesystem>
#include <string>
#include <vector>

#include "pkg/result.hpp"

namespace pkg {

struct LayoutConfig {
  std::string ports_dir = "ports";
  std::string groups_dir = "groups";
  std::string store_dir = "store";
  std::string build_dir = "build";
  std::string profile_dir = "profile";
  std::string current_profile = "profile/current";
  std::string lockfile = "ports.lock";
};

struct ResolverConfig {
  std::string strategy = "strict";
};

struct ProfileConfig {
  std::string activate_symlink = "/usr/local";
  std::string activate_target = "/usr/ports/profile/current";
  int generations_to_keep = 5;
};

struct Config {
  LayoutConfig layout;
  ResolverConfig resolver;
  ProfileConfig profile;
};

class ConfigStore {
 public:
  static constexpr const char* kConfigFilename = "pkg.toml";

  static Result<Config> load(const std::filesystem::path& root);
  static Status validate(const std::filesystem::path& root);
};

}  // namespace pkg
